Прерывание **INT 21h** — это основной шлюз (API) операционной системы MS-DOS. Когда вы пишете `int 21h`, вы просите операционную систему сделать «грязную работу» за вас: обработать нажатие клавиши, записать данные на диск, вывести текст на экран или узнать текущее время.

Всего в INT 21h содержится около 100 функций. Выбор функции осуществляется через регистр **AH**.

Ниже приведен разбор самых полезных функций, разбитых по категориям.

---

## 1. Ввод и вывод на консоль (Клавиатура и Экран)

Это база для любой интерактивной программы.

### Вывод символа (AH = 02h)
Выводит один символ на экран в текущую позицию курсора.
*   **Вход:** `DL` = ASCII код символа.
*   **Пример:** Вывод буквы 'A'.
    ```asm
    mov ah, 02h
    mov dl, 'A'  ; или 65
    int 21h
    ```

### Ввод символа с эхом (AH = 01h)
Программа останавливается и ждет нажатия клавиши. Нажатый символ появляется на экране ("эхо").
*   **Выход:** `AL` = ASCII код нажатой клавиши.
*   **Пример:**
    ```asm
    mov ah, 01h
    int 21h
    ; теперь в AL лежит код символа, например 'Y'
    ```
    *Примечание: Если вам нужно считать символ БЕЗ вывода на экран (например, пароль), используйте функцию **AH = 08h**.*

### Вывод строки (AH = 09h)
Выводит строку текста до знака доллара (`$`).
*   **Вход:** `DX` = адрес начала строки (offset).
*   **Пример:**
    ```asm
    .data
       msg db 'Hello World$'
    .code
       mov ah, 09h
       lea dx, msg
       int 21h
    ```

### Ввод строки в буфер (AH = 0Ah)
Самый сложный, но правильный способ считать строку (например, имя пользователя).
Требует специальной структуры буфера в сегменте данных.

**Структура буфера:**
1.  1-й байт: Максимальная длина ввода (задаете вы).
2.  2-й байт: Реальная длина (заполняет DOS после ввода).
3.  Остальные байты: Сама строка.

**Пример:**
```asm
.data
    ; Буфер на 20 символов + 2 служебных байта
    inputBuf db 20        ; Макс длина (мы разрешаем 20)
             db 0         ; Сюда DOS запишет, сколько реально ввели
             db 20 dup(0) ; Место под символы (забито нулями)
.code
    mov ah, 0Ah
    lea dx, inputBuf
    int 21h
    
    ; После ввода, если юзер ввел "Hi" и нажал Enter:
    ; inputBuf[1] станет равно 2 (длина).
    ; Сама строка начнется с inputBuf[2].
```

---

## 2. Работа с файлами (File Handle)

В современном Ассемблере (начиная с DOS 2.0) работа с файлами идет через **дескрипторы (Handle)**. Это просто число (номер), которое ОС выдает вам при открытии файла.

### Создание файла (AH = 3Ch)
Создает новый файл или обнуляет существующий.
*   **Вход:** `CX` = атрибуты файла (0 - обычный), `DX` = адрес имени файла (строка заканчивается нулем, **ASCIIZ**).
*   **Выход:** Если успешно, `AX` = дескриптор (handle). Если ошибка, флаг `CF` = 1.

### Открытие файла (AH = 3Dh)
*   **Вход:** `AL` = режим доступа (0 - чтение, 1 - запись, 2 - чтение/запись), `DX` = адрес имени файла (ASCIIZ).
*   **Выход:** `AX` = дескриптор.

### Запись в файл (AH = 40h)
*   **Вход:**
    *   `BX` = дескриптор файла (полученный ранее).
    *   `CX` = количество байт для записи.
    *   `DX` = адрес буфера с данными.
*   **Выход:** `AX` = количество реально записанных байт.

### Чтение из файла (AH = 3Fh)
*   **Вход:**
    *   `BX` = дескриптор.
    *   `CX` = сколько байт прочитать.
    *   `DX` = куда класть данные (буфер).
*   **Выход:** `AX` = количество прочитанных байт. Если AX=0, значит файл кончился (EOF).

### Закрытие файла (AH = 3Eh)
Обязательно закрывайте файлы, иначе данные могут не сохраниться!
*   **Вход:** `BX` = дескриптор.

---

## 3. Системные функции (Время и Дата)

### Получение текущей даты (AH = 2Ah)
*   **Выход:**
    *   `CX` = Год (например, 2023).
    *   `DH` = Месяц (1-12).
    *   `DL` = День (1-31).
    *   `AL` = День недели (0=Вс, 1=Пн...).

### Получение текущего времени (AH = 2Ch)
*   **Выход:**
    *   `CH` = Часы.
    *   `CL` = Минуты.
    *   `DH` = Секунды.
    *   `DL` = Сотые доли секунды.

---

## 4. Пример: Запись введенной фразы в файл
Этот пример объединяет ввод строки и запись в файл. Это классическая задача.

```asm
.model small
.stack 100h

.data
    filename db 'output.txt', 0  ; Имя файла (заканчивается 0)
    
    ; Буфер для ввода (макс 50 символов)
    maxLen   db 50
    realLen  db ?                ; Сюда DOS запишет длину
    textData db 50 dup(?)        ; Место для текста
    
    prompt   db 'Enter text: $'
    errMsg   db 'Error!$'
    okMsg    db 0Dh, 0Ah, 'Saved to output.txt$' ; Переход строки + текст

    fileHandle dw ?              ; Переменная для хранения номера файла

.code
start:
    mov ax, @data
    mov ds, ax

    ; 1. Выводим приглашение "Enter text: "
    mov ah, 09h
    lea dx, prompt
    int 21h

    ; 2. Читаем строку с клавиатуры (функция 0Ah)
    mov ah, 0Ah
    lea dx, maxLen    ; Указываем на начало структуры буфера
    int 21h

    ; 3. Создаем файл
    mov ah, 3Ch
    mov cx, 0         ; Атрибуты (обычный файл)
    lea dx, filename
    int 21h
    jc error_handler  ; Если ошибка (Jump if Carry), прыгаем на метку ошибки

    mov fileHandle, ax ; Сохраняем полученный номер файла

    ; 4. Записываем данные в файл
    mov ah, 40h
    mov bx, fileHandle ; В BX кладем номер файла
    
    mov ch, 0
    mov cl, realLen    ; В CX кладем длину введенного текста (из буфера)
    lea dx, textData   ; В DX - адрес самого текста
    int 21h

    ; 5. Закрываем файл
    mov ah, 3Eh
    mov bx, fileHandle
    int 21h

    ; 6. Сообщаем об успехе
    mov ah, 09h
    lea dx, okMsg
    int 21h
    jmp final

error_handler:
    mov ah, 09h
    lea dx, errMsg
    int 21h

final:
    mov ah, 4Ch
    int 21h
end start
```

## Шпаргалка по регистрам для INT 21h

| Регистр | Роль |
| :--- | :--- |
| **AH** | Номер функции (всегда!). |
| **AL** | Часто используется для возврата результата (код символа, код ошибки). |
| **DX** | Почти всегда указывает адрес данных (строки, буфера, имени файла). |
| **CX** | Обычно счетчик (сколько байт записать/прочитать) или год. |
| **BX** | Обычно дескриптор файла (handle). |

Если вы работаете с TASM, я очень рекомендую найти справочник "Ralf Brown's Interrupt List" или использовать встроенную справку в старых IDE, но для начала этих функций вам хватит на 90% студенческих задач.