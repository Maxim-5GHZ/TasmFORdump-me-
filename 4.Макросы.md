Макрос в TASM — это кусок кода, которому вы даете имя. Когда компилятор встречает это имя в программе, он просто копирует (подставляет) содержимое макроса в это место. Это очень удобно, чтобы не писать одни и те же команды (`mov ah, 09h`, `int 21h` и т.д.) по сто раз.

### 1. Базовый синтаксис

Макрос объявляется **до** сегмента кода (обычно в самом начале файла).

```asm
Имя_Макроса MACRO [параметр1, параметр2]
    ; Твой код
    ; В коде используешь параметры как обычные слова
ENDM
```

---

### 2. Простой пример: Макрос вывода строки

Обычно, чтобы вывести строку, вы пишете 3 строки кода. Сделаем макрос `Print`.

```asm
Print MACRO text_address
    mov ah, 09h
    mov dx, offset text_address ; подставляем параметр
    int 21h
ENDM
```

Теперь в коде вместо трех строк можно писать одну: `Print msg1`.

---

### 3. Важный нюанс: Метки внутри макроса (`LOCAL`)

Если внутри макроса есть циклы или переходы (метки), нужно использовать директиву **`LOCAL`**.
**Почему?** Если вы вызовете макрос два раза, компилятор вставит код два раза. Если там будет метка (например, `loop_start:`), то получится две метки с одинаковым именем — будет ошибка "Duplicate symbol".

`LOCAL` создает уникальные имена меток для каждого вызова.

**Пример: Макрос задержки (пустой цикл)**
```asm
Delay MACRO
    LOCAL wait_loop    ; Объявляем метку локальной
    
    mov cx, 0FFFFh     ; Счетчик
wait_loop:             ; Эта метка будет уникальной при каждом вызове
    dec cx
    jnz wait_loop
ENDM
```

---

### 4. Полный пример программы с макросами

Вот ваш предыдущий код, переписанный красиво с использованием макросов.

```asm
; --- ОБЪЯВЛЕНИЕ МАКРОСОВ ---

; Макрос для вывода строки
PrintStr MACRO str_name
    mov ah, 09h
    mov dx, offset str_name
    int 21h
ENDM

; Макрос для выхода из программы
ExitDOS MACRO
    mov ah, 4Ch
    int 21h
ENDM

; --- САМА ПРОГРАММА ---
.model small
.stack 100h

.data 
    msg1 db 'Hello Macro World!', 10, 13, '$'
    msg2 db 'It works perfect.', 10, 13, '$'

.code
start:
    mov ax, @data
    mov ds, ax

    ; Используем наши макросы
    PrintStr msg1     ; Развернется в 3 команды
    PrintStr msg2     ; Снова развернется в 3 команды

    ExitDOS           ; Развернется в 2 команды выхода

end start
```

### 5. Советы
1.  **Где писать:** Макросы лучше писать в самом верху файла или выносить в отдельный файл (например, `macros.inc`) и подключать командой `include macros.inc`.
2.  **Регистры:** Будьте осторожны. Если ваш макрос меняет регистры (например, `AX` или `CX`), а вы хранили там важные данные, программа сломается. Хорошим тоном считается сохранять регистры в стек (`push ax` ... `pop ax`) внутри макроса, если он делает что-то сложное.

Пример безопасного макроса (сохраняет регистры):
```asm
SafePrint MACRO text
    push ax         ; Сохранили текущее значение AX
    push dx         ; Сохранили DX

    mov ah, 09h
    mov dx, offset text
    int 21h

    pop dx          ; Вернули DX
    pop ax          ; Вернули AX
ENDM
```



